<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core" xmlns:ant="jelly:ant"
	xmlns:deploy="deploy">
	<postGoal name="war:war">
		<ant:copy file="metaz.props" todir="target/metaz/WEB-INF/classes" failonerror="false"/>
		<ant:copy file="src/main/java/hibernate.cfg.xml" todir="target/metaz/WEB-INF/classes" failonerror="true"/>
		<ant:copy file="src/main/java/org/metaz/domain/MetaData.hbm.xml" todir="target/metaz/WEB-INF/classes/org/metaz/domain" failonerror="true"/>
		<ant:copy file="src/main/java/org/metaz/domain/Record.hbm.xml" todir="target/metaz/WEB-INF/classes/org/metaz/domain" failonerror="true"/>
	</postGoal>
	<preGoal name="test:test">
		<ant:copy file="src/main/java/hibernate.cfg.xml" todir="target/test-classes" failonerror="true"/>
		<ant:copy file="src/main/java/org/metaz/domain/MetaData.hbm.xml" todir="target/test-classes/org/metaz/domain" failonerror="true"/>
		<ant:copy file="src/main/java/org/metaz/domain/Record.hbm.xml" todir="target/test-classes/org/metaz/domain" failonerror="true"/>
	</preGoal>
	<goal name="generateTestXml">
		<attainGoal name="test:compile"/>
		<attainGoal name="java:compile"/>
		<ant:java classname="org.metaz.test.toxgene.GenerateTestXml">
			<arg path="test/toxgene/300records.tsl"/>
			<classpath>
				<pathelement path="${basedir}/target/test-classes"/>
				<pathelement path="${basedir}/target/classes"/>
			</classpath>
		</ant:java>
	</goal>
	<goal name="war-inplace">
		<attainGoal name="java:compile" />
		<ant:copy file="metaz.props" todir="src/webapp/WEB-INF/classes" failonerror="false"/>
		<ant:copy file="src/main/java/hibernate.cfg.xml" todir="src/webapp/WEB-INF/classes" failonerror="true"/>
		<ant:copy file="src/main/java/org/metaz/domain/MetaData.hbm.xml" todir="src/webapp/WEB-INF/classes/org/metaz/domain" failonerror="true"/>
		<ant:copy file="src/main/java/org/metaz/domain/Record.hbm.xml" todir="scr/webapp/WEB-INF/classes/org/metaz/domain" failonerror="true"/>
		<j:forEach var="lib" items="${pom.artifacts}">
			<j:set var="dep" value="${lib.dependency}"/>
			<j:if test="${dep.getProperty('war.bundle')=='true'}">
				<ant:copy failonerror="true" todir="${basedir}/src/webapp/WEB-INF/lib">
					<fileset dir="${maven.repo.local}/${dep.groupId}/jars">
						<include name="${dep.artifactId}-${dep.version}.${dep.type}"/>
					</fileset>
				</ant:copy>
			</j:if>
		</j:forEach>
		<ant:exec executable="linkd.exe"
			dir="${basedir}/src/webapp/WEB-INF">
			<ant:arg line="classes ${maven.build.dest}"/>
		</ant:exec>
	</goal>
</project>